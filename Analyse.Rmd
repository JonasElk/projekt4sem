---
title: "Analyse"
author: "Jonas E_llkjær"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE_l}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(tidyverse)
library(ggplot2)
library(tinytex)
library(dplyr)
library(hrbrthemes)
library(viridis)
library(zoo)
library(stringr)
library(ggrepel)
library(pander)
library(broom)
library(dynlm)
library(lmtest)
library(stargazer)
library(AER)
library(sandwich)
library(texreg)
options(digits = 8)
options(scipen = 999)
rm(list=ls())
```

```{r}
data = read_xlsx("data/data.xlsx")
data = data[-c(1:11),]
#data = data[-c(50:52),]
```

```{r}
C_l = ts(log(data$c), start = 1971, frequency = 1)
I_l = ts(log(data$Ipr_faste), start = 1971, frequency = 1)
ps = ts(data$ps/100, start = 1971, frequency = 1)
W_l = ts(log(data$W), start = 1971, frequency = 1)
R_l = ts(log(data$R), start = 1971, frequency = 1)
ulc_l = ts(log(data$ulc), start = 1971, frequency = 1)
Pm_l = ts(log(data$Pm), start = 1971, frequency = 1)
Px_l = ts(log(data$Px), start = 1971, frequency = 1)
X_l = ts(log(data$X), start = 1971, frequency = 1)
Yrw_l = ts(log(data$Yrw_dk), start = 1971, frequency = 1)
M_l = ts(log(data$M), start = 1971, frequency = 1)
rulc_l = ts(log(data$rulc), start = 1971, frequency = 1)
E_l = ts(log(data$E), start = 1971, frequency = 1)
P_l = ts(log(data$P), start = 1971, frequency = 1)
Y_l = ts(log(data$Y), start = 1971, frequency = 1)
Yf_l = ts(log(data$Yff), start = 1971, frequency = 1)

#OBS på NaNs ved r pga negative værdier - M_luligvis plus rente med 7 for at undgå? ændrer det noget?
r = ts(data$r, start = 1971, frequency = 1)
```

#Forbrug - Rigtig
```{r}
#Bjarke med alle variable
dfm = dynlm(d(C_l) ~ d(R_l) + d(W_l))
summary(dfm)

dfm$coefficients
as.numeric(dfm$coefficients[2]*mean(C_l/R_l)-dfm$coefficients[3]*mean(C_l/W_l))
```

```{r results='asis'}
stargazer(dfm, omit.stat = c("f", "ser"))
```

#Investeringer - skal rettes
```{r}
#Svar fra Mikael
dfm7 = dynlm(d(I_l) ~ ps + d(Y_l) + d(r))
summary(dfm7)

as.numeric(dfm7$coefficients[2]*mean(I_l/R_l))
```

```{r results='asis'}
stargazer(dfm7, omit.stat = c("f", "ser"))
```




#Nettoeksport
```{r}
#Prisdeflator regression
dfmP_l = dynlm(d(P_l) ~ d(ulc_l) + d(Pm_l))
summary(dfmP_l)
eP_l = as.numeric(dfmP_l$coefficients[2])

#Eksportprisdeflator regression - Ingen signifikans af ULC, mærkeligt - fuck
dfmPx = dynlm(d(Px_l) ~ d(ulc_l) + d(Pm_l))
summary(dfmPx)
dfmPx_robust <- coeftest(dfmPx, vcov = vcovHC(dfmPx, type = "HC0"))
screenreg(list(OLS = dfmPx, OLS_robust_se = dfmPx_robust), digits = 4)

ePX = as.numeric(dfmPx$coefficients[2])

#Eksportregression
dfmX = dynlm(d(X_l) ~ d(log(data$Px/data$Pm)) + d(Yrw_l) + d(E_l))
summary(dfmX)
dfmX$coefficients
eXP = as.numeric(dfmX$coefficients[2])

#Importregression - Log(P/Pm) er ikke signifikant
dfmM = dynlm(d(M_l) ~ d(log(data$P/data$Pm)) + d(Y_l) + d(E_l))
summary(dfmM)
dfmM$coefficients
eMP = 0
```

##M_larginale effekter
```{r}
#M_larginal effekt af eksport
-(eX_lP_l*eP_lX_l*(1/(1-eP_l))*mean(Yf_l/Y_l))*(mean(X_l/Y_l)/mean(rulc_l))

#M_larginal effekt på import
-(eM_lP_l*eP_l*(1/(1-eP_l))*mean(Yf_l/Y_l))*(mean(X_l/Y_l)/mean(rulc_l))
```

